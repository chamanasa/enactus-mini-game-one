<!DOCTYPE html>
<html>
<head>
    <title>Enactus Mini Game-1 (Absolute Ranking)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --bg: #f8f9fa;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            padding: 10px;
            margin: 0;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        h1 { font-size: 1.5rem; margin-bottom: 10px; }

        .round-box {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        @media (min-width: 600px) {
            .input-grid { grid-template-columns: repeat(4, 1fr); }
            .container { padding: 30px; }
        }

        .team-input {
            border: 1px solid #ddd;
            padding: 12px 5px;
            border-radius: 8px;
            text-align: center;
            background: #fff;
        }

        .team-input label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .team-input input {
            width: 80%;
            max-width: 60px;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            text-transform: uppercase;
            border: 2px solid var(--accent);
            border-radius: 6px;
            outline: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        button {
            flex: 1;
            max-width: 200px;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn-go { background: var(--success); color: white; }
        .btn-reset { background: var(--danger); color: white; }

        .victory {
            display: none;
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            border: 1px solid #eee;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.85rem;
        }

        th { background: #f8f9fa; color: var(--primary); }
        .leader { background: #fff9c4; font-weight: bold; }

        .rules-hint {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
            background: #eee;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Enactus Mini Game-1</h1>
            <div class="round-box">Round: <span id="roundDisp">1</span>/6</div>
        </div>

        <div id="winMsg" class="victory">
            <h2 style="margin:0">Game Over!</h2>
            <p id="winnerLine" style="font-weight:bold; font-size:1.2rem;"></p>
        </div>

        <div class="input-grid" id="grid"></div>

        <div class="controls">
            <button id="subBtn" class="btn-go" onclick="runRound()">Process Round</button>
            <button class="btn-reset" onclick="reset()">Reset</button>
        </div>

        <h2>Scoreboard</h2>
        <div class="rules-hint">
            <strong>Ranking Rules:</strong> 1. Total Score | 2. More 5s | 3. More 3s | 4. More 1s | 5. Reached final score in earliest round.
        </div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>Score</th>
                        <th>5s</th>
                        <th>3s</th>
                        <th>1s</th>
                        <th>Finished In</th>
                    </tr>
                </thead>
                <tbody id="scoreBody"></tbody>
            </table>
        </div>

        <div style="margin-top: 30px;">
            <h2>Decision History</h2>
            <div class="table-wrapper">
                <table>
                    <thead><tr id="histHead"><th>Team</th></tr></thead>
                    <tbody id="histBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let round = 1;
        const MAX_ROUNDS = 6;
        let done = false;
        
        let teams = Array.from({length: 8}, (_, i) => ({ 
            id: i+1, 
            name: "Team "+(i+1), 
            score: 0, 
            count5: 0, 
            count3: 0, 
            count1: 0, 
            history: [], 
            log: [] 
        }));

        function setup() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            teams.forEach(t => {
                grid.innerHTML += `
                    <div class="team-input">
                        <label>${t.name}</label>
                        <input id="t${t.id}" maxlength="1" placeholder="R/G/B">
                    </div>`;
            });
            updateUI();
        }

        function runRound() {
            if (done) return;
            let selections = {};
            let counts = { R: 0, G: 0, B: 0 }; 

            for (let i = 1; i <= 8; i++) {
                let val = document.getElementById('t'+i).value.toUpperCase().trim();
                if (!['R','G','B'].includes(val)) {
                    alert("Team "+i+" must enter R, G, or B");
                    return;
                }
                selections[i] = val;
                counts[val]++;
            }

            teams.forEach(t => {
                let choice = selections[t.id];
                let n = counts[choice];
                let pts = 0;

                if (n === 1) { pts = 5; t.count5++; }
                else if (n === 2) { pts = 3; t.count3++; }
                else if (n === 3) { pts = 1; t.count1++; }
                
                t.score += pts;
                t.history.push(t.score); 
                t.log.push({ choice, pts });
            });

            updateUI();

            if (round >= MAX_ROUNDS) {
                endGame();
            } else {
                round++;
                document.getElementById('roundDisp').innerText = round;
                teams.forEach(t => document.getElementById('t'+t.id).value = '');
            }
        }

        function getFirstRoundAtScore(team) {
            // Find the index of the first time their current total score appears in history
            // index 0 = Round 1, so we add 1
            const firstIdx = team.history.indexOf(team.score);
            return firstIdx === -1 ? round : firstIdx + 1;
        }

        function getRankings() {
            return [...teams].sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                if (b.count5 !== a.count5) return b.count5 - a.count5;
                if (b.count3 !== a.count3) return b.count3 - a.count3;
                if (b.count1 !== a.count1) return b.count1 - a.count1;
                
                // Final Tiebreaker: Earliest round to reach current total
                let roundA = getFirstRoundAtScore(a);
                let roundB = getFirstRoundAtScore(b);
                if (roundA !== roundB) return roundA - roundB; // Lower round is better
                
                return a.id - b.id; 
            });
        }

        function updateUI() {
            const sorted = getRankings();
            const sBody = document.getElementById('scoreBody');
            
            sBody.innerHTML = sorted.map((t, i) => `
                <tr class="${i === 0 && t.score > 0 ? 'leader' : ''}">
                    <td>${i+1}</td>
                    <td><strong>${t.name}</strong></td>
                    <td>${t.score}</td>
                    <td>${t.count5}</td>
                    <td>${t.count3}</td>
                    <td>${t.count1}</td>
                    <td>R${getFirstRoundAtScore(t)}</td>
                </tr>`).join('');

            const hHead = document.getElementById('histHead');
            hHead.innerHTML = '<th>Team</th>' + Array.from({length: round}, (_, i) => `<th>R${i+1}</th>`).join('');

            const hBody = document.getElementById('histBody');
            hBody.innerHTML = teams.map(t => `
                <tr>
                    <td><strong>${t.name}</strong></td>
                    ${t.log.map(l => `<td>${l.choice} (${l.pts})</td>`).join('')}
                </tr>`).join('');
        }

        function endGame() {
            done = true;
            document.getElementById('winMsg').style.display = 'block';
            document.getElementById('subBtn').disabled = true;
            const sorted = getRankings();
            document.getElementById('winnerLine').innerText = "Winner: " + sorted[0].name;
        }

        function reset() {
            if (confirm("Reset game?")) location.reload();
        }

        setup();
    </script>
</body>
</html>
